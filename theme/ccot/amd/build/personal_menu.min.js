define(["jquery","core/log","core/yui","theme_ccot/pm_course_cards","theme_ccot/util","theme_ccot/ajax_notification"],function(a,b,c,d,e,f){var g=function(){var c=this,g=!1;this.update=function(){if(g){var c=M.cfg.wwwroot+"/user/policy.php";return void(window.location=c)}d.reqCourseInfo(d.getCourseIds()),a("#ccot-pm").focus();var h=function(c){var d=a("#ccot-personal-menu-"+c);if(a(d).length){var g=M.cfg.sesskey+"personal-menu-"+c;try{if(e.supportsSessionStorage()&&window.sessionStorage[g]){b.info("using locally stored "+c);var h=window.sessionStorage[g];a(d).html(h)}b.info("fetching "+c),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/ccot/rest.php?action=get_"+c+"&contextid="+M.cfg.context,success:function(h){f.ifErrorShowBestMsg(h).done(function(f){f||(b.info("fetched "+c),e.supportsSessionStorage()&&"undefined"!=typeof h.html&&(window.sessionStorage[g]=h.html),a(d).attr("data-content-loaded","1"),a(d).html(h.html))})}})}catch(i){sessionStorage.clear(),b.error(i)}}};h("deadlines"),h("graded"),h("grading"),h("messages"),h("forumposts"),a(document).trigger("ccotUpdatePersonalMenu")};var h=function(){var b=function(b){var c=a("#ccot-pm-content section"),d=a(c).outerWidth(),e=a(b),f=a("#ccot-pm-updates section > div").index(e)+1,g=d*f,h=a(b).outerHeight()+200;"#ccot-pm-courses"==b&&(g=0);var i=a(window).height();return h<i&&(h=i),{left:g,height:h}};a(window).on("resize",function(){if(window.innerWidth>=992)return void a("#ccot-pm-content").removeAttr("style");var c=a("#ccot-pm-mobilemenu a.state-active");if(c&&c.length){var d=c.attr("href"),e=b(d);a("#ccot-pm-content").css("left","-"+e.left+"px"),a("#ccot-pm-content").css("height",e.height+"px")}}),a(document).on("click","#ccot-pm-mobilemenu a",function(c){var d=this.getAttribute("href"),e=b(d);a("html, body").animate({scrollTop:0},0),a("#ccot-pm-content").animate({left:"-"+e.left+"px",height:e.height+"px"},"700","swing",function(){}),a("#ccot-pm-mobilemenu a").removeClass("state-active"),a(this).addClass("state-active"),c.preventDefault()})},i=function(){a(document).on("click",".js-ccot-pm-trigger",function(b){a("html, body").animate({scrollTop:0},0),a("body").toggleClass("ccot-pm-open"),a(".ccot-pm-open #ccot-pm").is(":visible")&&c.update(),b.preventDefault()}),h()};this.init=function(a){g=a,i(),g||d.init()}};return new g});