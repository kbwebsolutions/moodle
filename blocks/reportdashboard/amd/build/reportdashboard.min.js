define(["core/ajax","block_learnerscript/report","block_learnerscript/reportwidget","block_learnerscript/schedule","block_learnerscript/helper","block_learnerscript/ajax","block_learnerscript/select2","block_learnerscript/jquery.dataTables","block_learnerscript/radioslider","block_learnerscript/flatpickr","core/str","jquery","jqueryui","block_learnerscript/bootstrapnotify","block_reportdashboard/inplace_editable"],function(e,t,s,i,r,a,o,l,n,d,c,p){return{init:function(){p(document).ajaxStop(function(){p(".loader").fadeOut("slow")}),r.Select2Ajax({}),p(".dashboard").change(function(){var e=p(this).val();p(".report_categories").val(e),s.DashboardTiles(),s.DashboardWidgets(),p(".viewmore").each(function(){p(this).attr("href")}),p(".breadcrumb-button.pull-xs-right").html(p(this).find("option:selected").text())}),p("#createdashbaord_form").submit(function(e){var t=p("#id_dashboard").val().trim();""!=t&&null!=t||(p("#id_error_dashboard").css("display","block"),p("#id_error_dashboard_nospaces").css("display","none"),e.preventDefault()),spaceexist=t.indexOf(" "),0<spaceexist&&""!=spaceexist&&(p("#id_error_dashboard").css("display","none"),p("#id_error_dashboard_nospaces").css("display","block"),e.preventDefault())}),p.ui.dialog.prototype._focusTabbable=p.noop;var e=p("#dashboard-header").position();p(".sidenav").offset({top:0}),p("#internalbsm").offset({top:e.top}),p("select[data-select2='1']").select2(),r.Select2Ajax({action:"reportlist",multiple:!0}),p(document).on("click",".filterform #id_filter_clear",function(e){p(this).parents(".mform").trigger("reset");var t=p(this).parents(".mform").find("#id_filter_activity"),i=p(this).parents(".block_reportdashboard").find(".report_dashboard_container"),r=i.data("reportid"),o=i.data("reporttype"),a=i.data("blockinstance");p(this).parents(".mform").find("#id_filter_users");smartfilter.EnrolledUsers({courseid:0,element:t}),smartfilter.CourseActivities({courseid:0,element:t}),p("select[data-select2='1']").select2("destroy").select2({theme:"classic"}),s.CreateDashboardwidget({reportid:r,reporttype:o,instanceid:a})}),p(document).on("change","select[name='filter_coursecategories']",function(){var e=this.value,t=p(this).closest(".mform").find("#id_filter_courses");0!=t.length&&smartfilter.categoryCourses({categoryid:e,element:t})}),p(document).on("change","select[name='filter_courses']",function(){var e=this.value,t=p(this).closest(".mform").find("#id_filter_activity"),i=p(this).closest(".mform").find("#id_filter_users");0!=t.length&&smartfilter.CourseActivities({courseid:e,element:t}),0!=i.length&&smartfilter.EnrolledUsers({courseid:e,element:i})}),n.init(p("#segmented-button"),{size:"medium",animation:!0,reportdashboard:!0}),d("#customrange",{mode:"range",onOpen:function(e,t,i){i.clear()},onClose:function(e,t,i){p("#ls_fstartdate").val(e[0].getTime()/1e3),p("#ls_fenddate").val(e[1].getTime()/1e3+86400),require(["block_learnerscript/reportwidget"],function(e){s.DashboardTiles(),s.DashboardWidgets()})}}),window.onclick=function(e){if(!e.target.matches(".dropbtn")){var t,i=document.getElementsByClassName("dropdown-content");for(t=0;t<i.length;t++){var r=i[t];p(r).hasClass("show")&&p(r).toggleClass("show")}}}},addblocks_to_dashboard:function(){c.get_string("addblockstodashboard","block_reportdashboard").then(function(e){var t="<img class='dialog_title_icon' alt='Add Widgets' src='"+M.util.image_url("add_widgets_icon","block_reportdashboard")+"'/>";p(".reportslist").dialog({title:e,modal:!0,minWidth:700,maxHeight:600,position:{within:"#licenceresult"}}),p(".reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick' title='Close'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"}),p(".reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(t+e)})},addtiles_to_dashboard:function(){c.get_string("addtilestodashboard","block_reportdashboard").then(function(e){var t="<img class='dialog_title_icon' alt='Add Tiles' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";p(".statistics_reportslist").dialog({title:e,modal:!0,minWidth:600,maxHeight:600,position:{within:"#licenceresult"}}),p(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick' title='Close'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"}),p(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(t+e)})},addnewdashboard:function(){c.get_string("addnewdashboard","block_reportdashboard").then(function(e){document.getElementById("id_dashboard").value="",p("#id_error_dashboard").css("display","none");var t="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";p(".newreport_dashboard").dialog({title:e,modal:!0,minWidth:450,maxHeight:600}),p(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"}),p(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(t+e)})},updatedashboard:function(r,o){c.get_string("updatedashboard","block_reportdashboard").then(function(e){p("#id_error_dashboard").css("display","none"),p("#id_error_dashboard_nospaces").css("display","none");var t="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";p(".newreport_dashboard").dialog({title:e,modal:!0,minWidth:450,maxHeight:600}),p(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"}),p(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(t+e),document.getElementById("id_dashboard").value=r,p("#createdashbaord_form").submit(function(e){var t=p("#id_dashboard").val().trim();if(""==t||null==t)return p("#id_error_dashboard").css("display","block"),p("#id_error_dashboard_nospaces").css("display","none"),e.preventDefault(),!1;if(spaceexist=t.indexOf(" "),0<spaceexist&&""!=spaceexist)return p("#id_error_dashboard").css("display","none"),p("#id_error_dashboard_nospaces").css("display","block"),e.preventDefault(),!1;var i={action:"updatedashboard"};i.role=o,i.oldname=r,i.newname=document.getElementById("id_dashboard").value,senddata=JSON.stringify(i);a.call({args:i,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"})})})},sendreportemail:function(i){c.get_strings([{key:"sendemail",component:"block_reportdashboard"}]).then(function(e){var t=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";i.nodeContent="sendreportemail"+i.instanceid,i.action="sendreportemail",i.title=e,AjaxForms=require("block_learnerscript/ajaxforms"),AjaxForms.init(i,t)})},reportfilter:function(t){var i=this;p(".report_filter_"+t.instanceid).length<1?e.call([{methodname:"block_learnerscript_reportfilter",args:{action:"reportfilter",reportid:t.reportid,instance:t.instanceid}}])[0].done(function(e){p("body").append("<div class='report_filter_"+t.instanceid+"' style='display:none;'>"+e+"</div>"),p("select[data-select2='1']").each(function(){p(this).hasClass("select2-hidden-accessible")||p(this).select2()}),i.reportFilterFormModal(t),p(".filterform"+t.instanceid+" .fitemtitle").hide(),p(".filterform"+t.instanceid+" .felement").attr("style","margin:0")}):i.reportFilterFormModal(t)},reportFilterFormModal:function(a){c.get_string("reportfilters","block_reportdashboard").then(function(r){var o="<img class='dialog_title_icon' alt='Filter' src='"+M.util.image_url("reportfilter","block_reportdashboard")+"'/>";p(".report_filter_"+a.instanceid).dialog({title:r,dialogClass:"reportfilter-popup",modal:!0,resizable:!0,autoOpen:!0,draggable:!1,width:420,height:"auto",appendTo:"#inst"+a.instanceid,position:{my:"center",at:"center",of:"#inst"+a.instanceid,within:"#inst"+a.instanceid},open:function(e,t){p(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"}),p(this).closest(".ui-dialog").find(".ui-dialog-title").html(o+r),p(".report_filter_"+a.instanceid+" form  #id_filter_apply").click(function(e){e.preventDefault(),e.stopImmediatePropagation(),0<p("#reportcontainer"+a.instanceid).html().length?a.singleplot=p("#reportcontainer"+a.instanceid).data("reporttype"):a.singleplot=p("#plotreportcontainer"+a.instanceid).data("reporttype");p(".filterform"+a.instanceid).serializeArray();a.container="#reporttype_"+a.reportid,require(["block_learnerscript/reportwidget"],function(e){e.CreateDashboardwidget({reportid:a.reportid,singleplot:a.singleplot,instanceid:a.instanceid}),p(".report_filter_"+a.instanceid).dialog("close")}),p(".report_filter_"+a.instanceid+" form #id_filter_clear").removeAttr("disabled")})}}),p(".report_filter_"+a.instanceid+" form #id_filter_clear").click(function(e){e.preventDefault(),p(".filterform"+a.reportid).trigger("reset"),require(["block_learnerscript/reportwidget"],function(e){e.DashboardWidgets(a),p(".report_filter_"+a.instanceid).dialog("close")}),p(".report_filter_"+a.instanceid).dialog("close")})})},DeleteWidget:function(t){c.get_string("deletewidget","block_reportdashboard").then(function(e){p("#delete_dialog"+t.instanceid).dialog({resizable:!0,autoOpen:!0,width:460,height:210,title:e,modal:!0,appendTo:"#inst"+t.instanceid,position:{my:"center",at:"center",of:"#inst"+t.instanceid,within:"#inst"+t.instanceid},open:function(e,t){p(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var i=p(".ui-icon-closethick").parent();p(i).attr({title:"Close"})}})})},Deletedashboard:function(t){c.get_string("deletedashboard","block_reportdashboard").then(function(e){t.instance;p("#dashboard_delete_popup_"+t.random).dialog({resizable:!1,height:150,width:375,modal:!0,title:e,open:function(e){p(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var t=p(".ui-icon-closethick").parent();p(t).attr({title:"Close"})},close:function(e,t){p(this).dialog("destroy").hide()}})})},schreportform:function(i){c.get_string("schedulereport","block_reportdashboard").then(function(e){var t=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";i.title=e,i.nodeContent="schreportform"+i.instanceid,i.action="schreportform",AjaxForms=require("block_learnerscript/ajaxforms"),AjaxForms.init(i,t)})}}});