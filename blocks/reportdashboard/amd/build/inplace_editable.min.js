define(["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url"],function(l,a,t,i,n,c,p){return l("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",function(t){if("keypress"!==t.type||13===t.keyCode){t.stopImmediatePropagation(),t.preventDefault();function o(e,n){!function(t){t.addClass("updating");var a=t.find("img.spinner");a.length?a.show():(a=l("<img/>").attr("src",p.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),t.append(a))}(e),a.call([{methodname:"block_reportdashboard_inplace_editable_dashboard",args:{prevoiusdashboardname:e.attr("data-prevoiusdashboardname"),pagetypepattern:e.attr("data-pagetypepattern"),subpagepattern:e.attr("data-subpagepattern"),value:n},done:function(t){var a=e.attr("data-roleshortname");window.location.href=""==a?M.cfg.wwwroot+"/blocks/reportdashboard/dashboard.php?dashboardurl="+t:M.cfg.wwwroot+"/blocks/reportdashboard/dashboard.php?dashboardurl="+t+"&role="+a},fail:function(t){var a=l.Event("updatefailed",{exception:t,newvalue:n});!function(t){t.removeClass("updating"),t.find("img.spinner").hide()}(e),e.trigger(a),a.isDefaultPrevented()||i.exception(t)}}],!0)}function r(t){t.find("input").off(),t.find("select").off(),t.html(t.attr("data-oldcontent")),t.removeAttr("data-oldcontent"),t.removeClass("inplaceeditingon"),t.find("[data-inplaceeditablelink]").focus()}var d=l(this).closest("[data-inplaceeditable]"),s=function(t,a){var e,n=t;for(e=0;e<a;e++)n+=String(Math.floor(10*Math.random()));return 0===l("#"+n).length?n:s(t,a)};l("span.inplaceeditable.inplaceeditingon").each(function(){r(l(this))}),function(t){t.addClass("inplaceeditingon"),t.attr("data-oldcontent",t.html());var a=t.attr("data-type"),e=t.attr("data-options");"toggle"===a?function(t,a){r(t),o(t,a)}(t,e):"select"===a?function(e,t){var a,n=l("<select></select>").attr("id",s("id_inplacevalue_",20)).addClass("custom-select"),i=l('<label class="accesshide">'+d.attr("data-editlabel")+"</label>").attr("for",n.attr("id"));for(a in t)n.append(l("<option>").attr("value",t[a].key).html(t[a].value));n.val(e.attr("data-value")),e.html("").append(i).append(n),n.focus(),n.select(),n.on("keyup change focusout",function(t){if(!c.behatsiterunning||"focusout"!==t.type){if("change"===t.type){var a=n.val();r(e),o(e,a)}("keyup"===t.type&&27===t.keyCode||"focusout"===t.type)&&r(e)}})}(t,l.parseJSON(e)):function(i){n.get_string("edittitleinstructions").done(function(t){var a=l('<span class="editinstructions">'+t+"</span>").attr("id",s("id_editinstructions_",20)),e=l('<input type="text"/>').attr("id",s("id_inplacevalue_",20)).attr("value",i.attr("data-value")).attr("aria-describedby",a.attr("id")).addClass("ignoredirty").addClass("form-control"),n=l('<label class="accesshide">'+d.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));i.html("").append(a).append(n).append(e),e.focus(),e.select(),e.on("keyup keypress focusout",function(t){if(!c.behatsiterunning||"focusout"!==t.type){if("keypress"===t.type&&13===t.keyCode){var a=e.val();r(i),o(i,a)}("keyup"===t.type&&27===t.keyCode||"focusout"===t.type)&&r(i)}})})}(t)}(d)}}),{}});