define(["jquery","block_learnerscript/ajax"],function(i,s){return{loadFragment:function(e,r,t,n){var c=i.Deferred();return i.when(function(e,r,t,n){var a=[];for(var c in n)a.push({name:c,value:n[c]});var o=i.Deferred();return s.call({args:t,url:t.url},!1).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o.promise()}(0,0,t,n)).then(function(e){var r=i(e.javascript),a="";r.each(function(e,t){var r=(t=i(t)).prop("tagName");if(r&&"script"==r.toLowerCase())if(t.attr("src")){var n=!1;i("script").each(function(e,r){return i(r).attr("src")==t.attr("src")&&(n=!0),!n}),n||(a+=" { ",a+=' node = document.createElement("script"); ',a+=' node.type = "text/javascript"; ',a+=' node.src = decodeURI("'+encodeURI(t.attr("src"))+'"); ',a+=' document.getElementsByTagName("head")[0].appendChild(node); ',a+=" } ")}else a+=" "+t.text()}),c.resolve(e.html,a)}).fail(function(e){c.reject(e)}),c.promise()}}});