define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","block_learnerscript/ajax","core/yui","core/templates","core/modal"],function(i,t,o,e,n,r,s,a,l){function u(t,o){this.args=t,this.contextid=1,this.url=o,this.nodeContent=t.nodeContent||"ajaxForm",this.init(this.args)}return u.prototype.modal=null,u.prototype.contextid=-1,u.prototype.init=function(t){var o=this.getBody();i("body").append("<div class='"+this.nodeContent+"'></div>");o.done(function(t){i(".ajaxForm").html(t.html),i("head").append(t.javascript)});var e=i("."+this.nodeContent).dialog({resizable:!0,autoOpen:!1,width:"60%",title:this.args.title,modal:!0,close:function(t,o){i(this).dialog("destroy").remove()}}),n=this;i("."+this.nodeContent+" .mform").bind("submit",function(t){t.preventDefault(),n.submitFormAjax(this)}),e.dialog("open")},u.prototype.getBody=function(t){return void 0===t?t=null:this.args.jsonformdata=JSON.stringify(t),r.call({args:this.args,url:this.url},!1)},u.prototype.handleFormSubmissionResponse=function(t){if(t.formerror){i(".ajaxForm").html(t.html),i("head").append(t.javascript);var o=this;i("."+this.nodeContent+" .mform").bind("submit",function(t){t.preventDefault(),o.submitFormAjax(this)})}else alert("Success!")},u.prototype.handleFormSubmissionFailure=function(t){},u.prototype.submitFormAjax=function(t){this.args.jsonformdata=i(t).serialize();var o=this;r.call({args:this.args,url:this.url}).done(function(t){o.handleFormSubmissionResponse(t)}).fail(function(t){})},u.prototype.submitForm=function(t){t.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(t){return new u(t,url)}}});