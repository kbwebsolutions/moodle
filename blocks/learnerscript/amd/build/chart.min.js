define(["jquery","core/ajax","block_learnerscript/highcharts","block_learnerscript/smartfilter","block_learnerscript/report"],function(d,i,c,r,t){return chart={HighchartsAjax:function(e){if(e.cols=JSON.stringify(e.cols),e.instanceid=e.reportid,e.filters=r.FilterData(e.instanceid),e.basicparams=JSON.stringify(r.BasicparamsData(e.instanceid)),e.filters.ls_fstartdate=d("#ls_fstartdate").val(),e.filters.ls_fenddate=d("#ls_fenddate").val(),void 0===e.filters.filter_courses){var t=d("#ls_courseid").val();1!=t&&(e.filters.filter_courses=t)}e.filters=JSON.stringify(e.filters);var a=i.call([{methodname:"block_learnerscript_generate_plotgraph",args:e}]);d("#report_plottabs").show(),d("#plotreportcontainer"+e.instanceid).html('<img src="'+M.util.image_url("loading","block_learnerscript")+'" id="reportloadingimage" />'),a[0].done(function(t){(t=JSON.parse(t))&&(!0===t.plot.error?d("#report_plottabs").hide():(t.plot.reportid=e.reportid,t.plot.reportinstance=e.reportid,t.plot.data&&0<t.plot.data.length?require(["block_learnerscript/report"],function(e){e.generate_plotgraph(t.plot)}):d("#plotreportcontainer"+e.instanceid).html("<div class='alert alert-warning'>No data available</div>")))})},piechart:function(e){c.chart(e.containerid,{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",width:e.width||null,height:e.height||null,margin:e.margin||null},credits:{enabled:!1},title:{text:e.title},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",shadow:!1,dataLabels:{enabled:e.datalabels},showInLegend:e.showlegend}},series:[{name:e.serieslabel,colorByPoint:!0,data:e.data,innerSize:"60%"}]})},lbchart:function(e){var t=e.type,a=["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"];void 0!==d(e.container).data("chartcolor")&&(a=["#"+d(e.container).data("chartcolor")]);c.chart(e.containerid,{chart:{type:t,height:e.height||null,zoomType:"x"},colors:a,credits:{enabled:!1},title:{text:e.title},xAxis:{categories:e.categorydata,labels:{enabled:1==e.datalabels},title:{text:e.ylabel}},yAxis:{title:{text:e.pcalcs?e.pcalcs:e.title}},plotOptions:{bar:{dataLabels:{enabled:1==e.datalabels},enableMouseTracking:1!=e.datalabels},line:{dataLabels:{enabled:1==e.datalabels},enableMouseTracking:1!=e.datalabels},column:{dataLabels:{enabled:1===e.datalabels},enableMouseTracking:1!==e.datalabels}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="padding:0">{series.name}</td><td> <b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},credits:{enabled:!0},legend:{enabled:e.showlegend},series:e.data,responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{align:"center",verticalAlign:"bottom",layout:"horizontal"},yAxis:{labels:{align:"left",x:0,y:10},title:{text:null}},subtitle:{text:null},credits:{enabled:!1}}}]}})},combinationchart:function(e){c.chart(e.containerid,{zoomType:"x",title:{text:e.chartname},xAxis:{categories:e.categorydata},credits:{enabled:!1},series:e.data})},WorldMap:function(e){c.mapChart(e.containerid,{chart:{borderWidth:1},colors:["rgba(19,64,117,0.05)","rgba(19,64,117,0.2)","rgba(19,64,117,0.4)","rgba(19,64,117,0.5)","rgba(19,64,117,0.6)","rgba(19,64,117,0.8)","rgba(19,64,117,1)"],title:{text:e.title},credits:{enabled:!1},mapNavigation:{enabled:!0,enableMouseWheelZoom:!1,enableDoubleClickZoom:!0},legend:{title:{text:e.serieslabel,style:{color:c.theme&&c.theme.textColor||"black"}},align:"left",verticalAlign:"bottom",floating:!0,layout:"vertical",valueDecimals:0,symbolRadius:0,symbolHeight:14},colorAxis:{dataClasses:[{to:3},{from:3,to:10},{from:10,to:30},{from:30,to:100},{from:100,to:300},{from:300,to:1e3},{from:1e3}]},series:[{data:e.data,mapData:c.maps["custom/world"],joinBy:["iso-a2","code"],name:e.serieslabel,states:{hover:{color:"#a4edba"}},shadow:!1}]})},TreeMap:function(e){c.mapChart(e.containerid,{credits:{enabled:!1},series:[{type:"treemap",allowDrillToNode:!0,layoutAlgorithm:"squarified",events:{click:function(e){d("#ls_courseid").val(e.point.id),t.DashboardTiles(),t.DashboardWidgets()}},levelIsConstant:!1,levels:[{level:1,dataLabels:{enabled:!0,align:"left",verticalAlign:"top",style:{fontSize:"11px"}}}],data:e.data}]})},SparkLines:function(e){c.SparkLine=function(e,t,a){var i="string"==typeof e||e.nodeName,r=arguments[i?1:0],l={chart:{renderTo:r.chart&&r.chart.renderTo||this,backgroundColor:null,borderWidth:0,type:"area",margin:[2,0,2,0],width:120,height:100,style:{overflow:"visible"},skipClone:!0},title:{text:""},credits:{enabled:!1},xAxis:{labels:{enabled:!1},title:{text:null},startOnTick:!1,endOnTick:!1,tickPositions:[]},yAxis:{endOnTick:!1,startOnTick:!1,labels:{enabled:!1},title:{text:null},tickPositions:[0]},legend:{enabled:!1},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,hideDelay:0,shared:!0,padding:0,positioner:function(e,t,a){return{x:a.plotX-e/2,y:a.plotY-t}}},plotOptions:{series:{animation:!1,lineWidth:1,shadow:!1,states:{hover:{lineWidth:1}},marker:{radius:1,states:{hover:{radius:2}}},fillOpacity:.25},column:{negativeColor:"#910000",borderColor:"silver",borderRadius:15}}};return r=c.merge(l,r),i?new c.Chart(e,r,a):new c.Chart(r,t)}},ProgressBar:function(e){c.chart(e.containerid,{title:{text:e.title},credits:{enabled:!1},chart:{renderTo:e.containerid,type:"bar",height:e.height||15,backgroundColor:e.backgroundColor||"transparent",margin:e.margin||null},plotOptions:{bar:{borderRadius:5},series:{cursor:"pointer",point:{events:{click:function(){void 0!==e.data.link&&require("block_learnerscript/helper").ReportModelFromLink({container:d("#"+e.containerid),url:e.data.link})}}}}},exporting:{enabled:!1},credits:e.credits||!1,tooltip:e.tooltip||!1,legend:e.legend||!1,xAxis:{visible:!1},yAxis:{visible:!1,min:0,max:100},series:[{data:[100],grouping:!1,animation:!1,enableMouseTracking:!1,showInLegend:!1,color:"#CCC",pointWidth:15,dataLabels:{className:"highlight",format:e.format||null,enabled:!1,align:"left",style:{color:"#1f5675",textOutline:!1,fontSize:"9px",fontWeight:"normal"}}},{enableMouseTracking:!0,data:e.data||[0],color:"rgb(93, 171, 255)",pointWidth:15,animation:{duration:250},dataLabels:{enabled:!0,inside:!0,align:"right",format:"{point.y}%",style:{color:"#FFF",textOutline:!1,fontSize:"9px",fontWeight:"normal"}}}]})},SparkLineReport:function(){new Date;var e,t,a,i,r,l,n=d(".spark-report"),o=(n.length,+new Date),s=n.length;for(e=0;e<s;e+=1){switch(a=(t=d(n[e])).data("sparkline"),stringLabels=t.data("labels"),stringlink=t.data("link"),i=a.split("; "),datalabels=stringLabels.split(", "),(r=d.map(i[0].split(", "),parseFloat)).link=stringlink,l={},i[1]&&(l.type=i[1]),l.containerid=t.attr("id"),l.chartname="",l.datalabels=!1,l.showlegend=!1,l.serieslabel=!1,l.categorydata=t.text(),i[1]){case"pie":l.data=r,l.width="65",l.height="65",l.margin=[0,0,0,0],this.piechart(l);break;case"line":case"bar":case"column":l.data={data:r,name:t.data("name"),type:"bar"},l.serieslabel=t.data("serieslabel"),l.title=t.data("title"),this.lbchart(l);break;case"progressbar":l.data=r,l.title=t.data("title"),l.width="100",l.height="15",l.margin=[0,0,0,0],this.ProgressBar(l);break;default:this.SparkLines(),c.SparkLine(t.attr("id"),{title:{text:""},credits:{enabled:!1},series:[{data:r,pointStart:1,dataLabels:{enabled:!1}}],tooltip:{headerFormat:'<span style="font-size: 10px">'+t.parent().find("th").html()+"<br/> Q{point.x}: </span>",pointFormat:" <b>{point.y}</b>"},chart:l})}if(1,500<new Date-o){n.splice(0,e+1),setTimeout(this.SparkLineReport,0);break}}}}});